<!DOCTYPE html>
<html lang="en">
<!-- https://chatgpt.com/c/688a6b59-aa54-8006-8252-81329ae9b044 -->
<head>
  <meta charset="UTF-8" />
  <title>Grid Letter Animation</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 50px;
    }
    .grid-row {
      display: flex;
      flex-direction: row;
      margin: 1px 0;
    }
    .cell {
      width: 20px;
      height: 20px;
      border: 1px solid #ddd;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      position: relative;
      overflow: hidden;
      margin: 0 1px;
    }
    .cell-x {
      width: 20px;
      height: 20px;
      border: 1px solid #6fd86f;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      position: relative;
      overflow: hidden;
      margin: 0 1px;
      background-color: #6fd86f;
    }
    .letter {
      position: relative;
      transition: transform 1s ease, opacity 1s ease;
      display: inline-block;
    }
    .z32 {
	    font-family: 'untitled2regular';
      position: relative;
      display: inline-block;
      color: #993333;
      /* position: relative; */
      /* display: inline-block; */
    }
    #links {
      margin-top: 1em;
    }

    #links a {
      display: list-item;
      font-size: 8pt;
    }

    #bottomRow {
      margin-top: 1em;
      margin-bottom: 1em;
    }
    @font-face {
        font-family: 'untitled2regular';
        src: url('z340-z408-combined-font-monospaced-webfont.woff2') format('woff2'),
            url('z340-z408-combined-font-monospaced-webfont.woff') format('woff');
        font-weight: normal;
        font-style: normal;
    }

  </style>
</head>
<body>
  <div class="grid-row" id="cipher">
    <div class="cell"><span class="z32">C</span></div>
    <div class="cell"><span class="z32">9</span></div>
    <div class="cell"><span class="z32">J</span></div>
    <div class="cell"><span class="z32">|</span></div>
    <div class="cell"><span class="z32">#</span></div>
    <div class="cell"><span class="z32">O</span></div>
    <div class="cell"><span class="z32">k</span></div>
    <div class="cell"><span class="z32">[</span></div>
    <div class="cell"><span class="z32">A</span></div>
    <div class="cell"><span class="z32">M</span></div>
    <div class="cell"><span class="z32">f</span></div>
    <div class="cell"><span class="z32">8</span></div>
    <div class="cell"><span class="z32">?</span></div>
    <div class="cell"><span class="z32">O</span></div>
    <div class="cell"><span class="z32">R</span></div>
    <div class="cell"><span class="z32">T</span></div>
    <div class="cell"><span class="z32">G</span></div>
    <div class="cell"><span class="z32">X</span></div>
    <div class="cell"><span class="z32">6</span></div>
    <div class="cell"><span class="z32">F</span></div>
    <div class="cell"><span class="z32">D</span></div>
    <div class="cell"><span class="z32">V</span></div>
    <div class="cell"><span class="z32">j</span></div>
    <div class="cell"><span class="z32">%</span></div>
    <div class="cell"><span class="z32">H</span></div>
    <div class="cell"><span class="z32">C</span></div>
    <div class="cell"><span class="z32">E</span></div>
    <div class="cell"><span class="z32">L</span></div>
    <div class="cell"><span class="z32">z</span></div>
    <div class="cell"><span class="z32">P</span></div>
    <div class="cell"><span class="z32">W</span></div>
    <div class="cell"><span class="z32">9</span></div>
  </div>
  <div class="grid-row" id="topRow"></div>
  <div class="grid-row" id="bottomRow"></div>

  <!-- <button onclick="moveLetter(2, 1)">Move Letter</button>
  <button onclick="moveLetter(9, 0)">Move Letter</button>
  <button onclick="moveLetter(5, 3)">Move Letter</button>
  <button onclick="removeLetter(0)">Remove Letter</button> -->

  <div class="go"><button onclick="go()">Go</button></div>
  <div id="links"></div>

  <script>
    const topRow = document.getElementById('topRow');
    const bottomRow = document.getElementById('bottomRow');

    const solutions = [
      // ryan
[" IFELNIGWHDAINGOAOESNBXLT ETDIEI", "LIFE IN WAITING GOES ON BY LET IT DIE", 
  [-1, 1, 2, 3, 0, 5, 4, 12, 6, -1, -1, 7, 10, 11, 13, 14, -1, 17, 15, 16, 18, 19, -1, 21, 23, -1, 28, 25, 26, 27, 22, 24], // 4 orphans
  [[8, 'I'], [9, 'T'], [20, 'Y']]], // Sorted char distance: 5
[" IFELNIGWHDAINGOAOESNBXLT ETDIEI", "LIFE IN WHADING GOES ON BY LET IT DIE", 
  [-1, 1, 2, 3, 0, 5, 4, 12, 6, 7, 9, 8, 10, 11, 13, 14, -1, 17, 15, 16, 18, 19, -1, 21, 23, -1, 28, 25, 26, 27, 22, 24], // 2 orphans
  [[20, 'Y']]], // Sorted char distance: 2
// [" IFYLNIUWHDAKNGOAOESNBXLT ETDIEI", "FULY IN WRECK AND GOOD BLAST NEXT", 
//   [-1, -1, 0, 3, 2, 5, 4, 1, 6, -1, 13, 11, 10, 12, 14, 15, 20, 16, 8, 21, 23, 18, 25, 19, 22, -1, 24, 26, 17, -1, -1, -1], // 5 orphans
//   [[7, 'R'], [9, 'C']]], // Sorted char distance: 7
// ["EIFALNIOWHDA NGOAOESNBXLTEETDIEI", "FILE A IS NOW AND GOOD BLAST NEXT", 
//   [3, 1, 0, 4, 2, 7, 5, 8, 9, -1, 12, 10, -1, 11, 13, 15, 19, 14, -1, 20, 22, 17, 24, 18, 25, 23, -1, 21, 16, -1, -1, -1], // 6 orphans
//   [[6, 'S']]], // Sorted char distance: 7
// [" IF LNIXWHDADNGOAOESNBXLT ETDIEI", "FINE WILD HANDS GOOD BLAST EXTRI", 
//   [-1, 1, 0, -1, 6, 2, 5, -1, 4, 8, 11, 9, 16, 10, 13, 15, 19, 14, 22, 20, -1, 17, 23, 18, 24, -1, 3, 21, 7, 26, -1, -1], // 4 orphans
//   [[12, 'S'], [25, 'R']]], // Sorted char distance: 6
// [" IF LNIXWHDADNGOAOESNBXLT ETDIEI", "FINE WILD HANDS GOOD BLAST EXTRA", 
//   [-1, 1, 0, -1, 6, 2, 5, -1, 4, 8, 11, 9, 16, 10, 13, 15, 19, 14, 22, 20, -1, 17, 23, 18, 24, -1, 3, 21, 7, -1, -1, -1], // 5 orphans
//   [[12, 'S'], [25, 'R'], [26, 'A']]], // Sorted char distance: 8
[" IFFLNIGWHDA NGOAOESNBXLT ETDIEI", "FILM IF WE HANG ON A POST BLEED IT", 
  [-1, 1, 0, 5, 2, 10, 4, -1, 6, 8, -1, 9, -1, 13, 11, 16, 14, 12, 21, 17, -1, 19, -1, 20, 25, -1, 22, 18, 23, 24, 7, -1], // 5 orphans
  [[3, 'M'], [15, 'P']]], // Sorted char distance: 6
// ["OIFOLNIIWHDA NGOAOESNBXLTOETDIEI", "I OF OIL IN A WING HAD ONE SO BE IT", 
//   [1, 0, 2, 3, 5, 7, 6, 4, 9, 13, 15, 8, -1, 11, 12, 16, 14, 20, 18, 19, 17, 21, -1, -1, 24, -1, 22, -1, -1, 23, -1, 10], // 6 orphans
//   []], // Sorted char distance: 6
[" IFLLNITWHDA NGOAOESNBXLT ETDIEI", "ILL FIND TWO MAN HOLES AND TEXT", 
  [-1, 0, 3, 2, 1, 5, 4, 7, 8, 13, 6, 11, -1, 12, -1, 14, 18, 9, 16, 17, 19, -1, 23, 15, 24, -1, 22, 21, 20, -1, -1, -1], // 5 orphans
  [[10, 'M']]], // Sorted char distance: 6
["OIF LNITWHDASNGOAOESNBXLTOETDIEI", "HOLE IN IT WAS IN A GO FOR NEXT BOTTLE", 
  [1, 4, 16, -1, 2, 5, 6, 7, 8, 0, -1, 9, 10, 12, 14, 15, 13, 17, 20, -1, 19, 23, 21, 27, 25, 24, 28, 26, -1, 11, 3, -1], // 4 orphans
  [[18, 'R'], [22, 'T']]], // Sorted char distance: 5
["EIF LNISWHDA NGOAOESNBXLTEETDIEI", "EVIL IS IN HAND OR SEEN TO BE LEFT A DIM", 
  [0, 2, 24, -1, 3, 7, 6, 5, -1, 8, 11, 9, -1, 10, -1, 12, 26, 19, 16, 14, 17, 20, -1, 22, 25, 23, 21, 18, 27, 28, 15, 4], // 3 orphans
  [[1, 'V'], [13, 'R'], [29, 'M']]], // Sorted char distance: 5
["LIFILNITWHDA NGOAOESNBXLTLETDIEI", "WITH NINE I LOAD A GUN OR BE A LITTLE LIST", 
  [28, 1, -1, 8, 9, 4, 5, 2, 0, 3, 12, 11, -1, 16, 14, 10, 13, 17, 20, 30, 6, 19, -1, 22, 24, 26, 27, 25, -1, 29, 7, 23], // 3 orphans
  [[15, 'U'], [18, 'R'], [21, 'A'], [31, 'T']]], // Sorted char distance: 7
[" IFELNIAWHDATNGOAOESNBXLT ETDIEI", "LIFE IN A HEAD AND GOOD BLAST NEXT", 
  [-1, 1, 2, 3, 0, 5, 4, 6, -1, 7, 10, 11, -1, 12, 14, 15, 20, 16, 8, 21, 23, 18, 25, 19, 22, -1, 24, 26, 17, -1, -1, -1], // 5 orphans
  [[9, 'A'], [13, 'D']]], // Sorted char distance: 6
[" IFELNITWHDANNGOAOESNBXLT ETDIEI", "FIRE IN DONNA THE GOOD BLAST NEXT", 
  [-1, 1, 0, 3, -1, 5, 4, 11, -1, 12, 6, 10, 9, 8, 14, 15, 20, 16, 13, 21, 23, 18, 25, 19, 22, -1, 24, 26, 17, -1, -1, -1], // 5 orphans
  [[2, 'R'], [7, 'O']]], // Sorted char distance: 7
[" IF LNI WHDAENGOAOESNBXLT ETDIEI", "IF WE HANG LIN ON A POST LATER DIED", 
  [-1, 0, 1, -1, 8, 6, 9, -1, 2, 4, 23, 13, 3, 12, 7, 15, 19, 11, 21, 16, 10, -1, -1, 18, 20, -1, 25, 17, 26, 24, -1, -1], // 4 orphans
  [[5, 'A'], [14, 'P'], [22, 'R']]], // Sorted char distance: 6
[" IFPLNIAWHDAINGOAOESNBXLT ETDIEI", "FLIP IN RADIAN IS ONE GOOD HEAT ITEM", 
  [-1, 2, 0, 3, 1, 5, 4, 7, -1, 21, 8, 10, 12, 11, 17, 14, 23, 18, 16, 13, 15, -1, -1, -1, 24, -1, 27, 26, 20, 25, 22, 9], // 4 orphans
  [[6, 'R'], [19, 'O'], [28, 'M']]], // Sorted char distance: 6
[" IFULNIRWHDATNGOAOESNBXLT ETDIEI", "I WIN GUN DEATH BODIES RIOT NEXT FALL", 
  [-1, 0, 26, 5, 29, 6, 2, 18, 1, 11, 7, 9, 10, 3, 4, 13, 27, 20, 16, 17, 22, 12, 24, 28, 25, -1, 23, 21, 14, 19, 8, 15], // 0 orphans
  []], // Sorted char distance: 0
[" IFULNIRWHDATNGOAOESNBXLT ETDIEI", "I WIN DEATH RING OUT BODIES NEXT FALL", 
  [-1, 0, 26, 14, 29, 3, 2, 9, 1, 8, 4, 6, 15, 11, 12, 13, 27, 17, 20, 21, 22, 16, 24, 28, 25, -1, 23, 7, 18, 19, 5, 10], // 0 orphans
  []], // Sorted char distance: 0
[" IF LNISWHDA NGOAOESNBXLT ETDIEI", "BOX AND SELL IT IN A SIDE OF THE WING", 
  [-1, 12, 20, -1, 8, 4, 10, 6, 24, 22, 5, 3, -1, 13, 27, 1, 14, 19, 18, 15, 26, 0, 2, 9, 21, -1, 23, 11, 17, 25, 7, 16], // 0 orphans
  []], // Sorted char distance: 0
["CIF LNITWHDA NGOAOESNBXLTCETDIEI", "FAST WHEN IT DIED IN A COLLECTING BOX", 
  [17, 11, 0, -1, 19, 7, 8, 9, 4, 5, 10, 1, -1, 15, 26, 28, 16, 18, 21, 2, 25, 27, 29, 20, 23, 22, 12, 3, 13, 24, 6, 14], // 0 orphans
  []], // Sorted char distance: 0
[" IFOLNI WHDATNGOAOESNBXLT ETDIEI", "TAXES WITH ONE END OF IT IN A BIG DOLL", 
  [-1, 17, 16, 9, 28, 10, 6, -1, 5, 8, 14, 1, 7, 13, 24, 15, 21, 26, 12, 4, 20, 22, 2, 27, 18, -1, 11, 0, 25, 23, 3, 19], // 0 orphans
  []], // Sorted char distance: 0
[" IF LNILWHDA NGOAOESNBXLT ETDIEI", "SIX IN ALL OF IT IN THE NEW GOLD BEAD", 
  [-1, 1, 9, -1, 6, 4, 3, 7, 19, 15, 23, 5, -1, 13, 20, 8, 26, 21, 18, 0, 17, 24, 2, 22, 14, -1, 25, 11, 27, 12, 16, 10], // 0 orphans
  []], // Sorted char distance: 0
[" IF LNI WHDA NGOAOESNBXLT ETDIEI", "SHAWN TELLING IT IN A BED OF OXIDE", 
  [-1, 12, 21, -1, 7, 4, 9, -1, 3, 1, 19, 2, -1, 15, 11, 22, 16, 20, 18, 0, 10, 17, 23, 8, 13, -1, 26, 5, 25, 24, 6, 14], // 0 orphans
  []], // Sorted char distance: 0
[" IF LNI WHDAWNGOAOESNBXLT ETDIEI", "I DETOX AND WILL BE FINE WITH NO GAS", 
  [-1, 0, 15, -1, 11, 7, 10, -1, 9, 22, 8, 6, 19, 23, 25, 4, 26, 24, 18, 27, 17, 13, 5, 12, 21, -1, 14, 3, 1, 20, 2, 16], // 0 orphans
  []], // Sorted char distance: 0
[" IFALNIRWHDA NGOAOESNBXLT ETDIEI", "I LET INFANTS DIE ABROAD NOW LEIGH X", 
  [-1, 0, 6, 7, 1, 5, 4, 16, 22, 27, 11, 18, -1, 8, 26, 21, 14, 17, 13, 10, 20, 15, 28, 23, 9, -1, 24, 3, 19, 25, 2, 12], // 0 orphans
  []], // Sorted char distance: 0
  // 
  // Z340 key applied
  //
["YNSETAIADOBPEAORTRDFNOPTIYRGAIWN", "TRY TO BEG NOW AND PAY FOR IT IN PARADISE", 
  [2, 8, 30, 6, 3, 25, 20, 15, 13, 9, 5, 14, 31, 11, 4, 1, 0, 19, 28, 17, 23, 18, 24, 21, 22, 16, 26, 7, 27, 29, 10, 12], // 0 orphans
  []], // Sorted char distance: 0
["YNSETAIADOBPUAORTRDFNOPTIYRGAIWN", "A BODY TWO RADIANS IN FRONT PAGE PURITY ", 
  [4, 13, 14, 25, 5, 0, 11, 9, 10, 7, 1, 26, 27, 12, 2, 8, 30, 18, 3, 17, 20, 19, 22, 21, 15, 31, 28, 24, 23, 29, 6, 16], // 0 orphans
  []], // Sorted char distance: 0
["YNSETAIADOBPUAORTRDFNOPTIYRGAIWN", "I TRY A BODY TWO RADIANS UP IN FRONT PAGE", 
  [3, 17, 18, 31, 1, 4, 0, 16, 7, 11, 5, 28, 19, 13, 6, 12, 9, 2, 14, 23, 22, 25, 20, 27, 21, 8, 24, 30, 29, 15, 10, 26], // 0 orphans
  []], // Sorted char distance: 0  
["YNSETAI DOBP AORTRDFNOPTIYRGAIWN", "A RADIANT DYING PERSON PROFIT BY TWO", 
  [9, 6, 16, 14, 7, 5, 4, -1, 8, 29, 25, 13, -1, 2, 17, 15, 27, 20, 3, 22, 18, 21, 19, 24, 23, 26, 1, 12, 0, 10, 28, 11], // 0 orphans
  []], // Sorted char distance: 0  
];
    let which = 0;
    let topString = solutions[which][0];  
    let m = solutions[which][1].replace(/\s+/g, '').length;
    let moves = solutions[which][2];
    let fadeIns = solutions[which][3];

    const MS_PAUSE = 1250;
    const MS_REMOVE = 500;
    const MS_MOVE = 100;
    const MS_FADE_IN = 500;

    renderTopRow();
    renderLinks();

    function is408() {
      return topString.endsWith("ETDIEI");
    }

    function isHighlighted(pos) {
      if (is408()) return pos==0 || pos==3 || pos==7 || pos==12 || pos==25;
      return pos==7 || pos==12;
    }

    function renderTopRow() {
      let i=0;
      topString.split('').forEach(letter => {
        const cell = document.createElement('div');
        cell.className = 'cell';
        if (isHighlighted(i)) {
          cell.className = 'cell-x';
          document.getElementById("cipher").children[i].className="cell-x";
        } else document.getElementById("cipher").children[i].className="cell";
        const span = document.createElement('span');
        span.className = 'letter';
        span.textContent = letter;
        cell.appendChild(span);
        topRow.appendChild(cell);
        i++;
      });
    }

    renderBottomRow(); 

    function renderBottomRow() {
      for (let i = 0; i < m; i++) {
        const cell = document.createElement('div');
        cell.className = 'cell';
        bottomRow.appendChild(cell);
      }
    }

    function moveLetterStep(which) {
      if (which >= moves.length) {
        setTimeout(function() { fadeInLetterStep(0) }, MS_PAUSE);
        return;
      }
      if (moves[which] > -1)
        moveLetter(which, moves[which]);
      else
        removeLetter(which);
      setTimeout(function() { moveLetterStep(which+1); }, MS_MOVE);
    }

    function fadeInLetterStep(which) {
      if (which >= fadeIns.length) {
        return;
      }
      fadeInLetter(fadeIns[which][0], fadeIns[which][1]);
      setTimeout(function() { fadeInLetterStep(which+1); }, MS_FADE_IN);
    }

    function hasRemoves() {
      for (let i=0; i<moves.length; i++) if (moves[i] == -1 && topString[i] != ' ') return true;
      return false;
    }
    function go() {
      if (hasRemoves())
        setTimeout(function() { removeLetterStep(0); } , MS_REMOVE);
      else 
        moveLetterStep(0);
    }

    function removeLetterStep(which) {
      if (which >= moves.length) {
        setTimeout(function() { moveLetterStep(0); } , MS_PAUSE);
        return;
      }
      if (moves[which] == -1 && topString.charAt(which) != ' ') {
        removeLetter(which);
        setTimeout(function() { removeLetterStep(which+1); } , MS_REMOVE);
      } else removeLetterStep(which+1);
    }

    function moveAll() {
      setTimeout(function() { moveLetterStep(0); }, MS);
    }

    function moveLetter(fromIndex, toIndex) {
      const fromCell = topRow.children[fromIndex];
      const letter = fromCell.querySelector('.letter');
      const toCell = bottomRow.children[toIndex];

      const fromRect = letter.getBoundingClientRect();
      const toRect = toCell.getBoundingClientRect();

      const dx = (toRect.left + toRect.width / 2 + 5) - (fromRect.left + fromRect.width / 2);
      const dy = (toRect.top + toRect.height / 2 + 10) - (fromRect.top + fromRect.height / 2);

      letter.style.position = 'fixed';
      letter.style.left = `${fromRect.left + fromRect.width / 2 - 5}px`;
      letter.style.top = `${fromRect.top + fromRect.height / 2 - 10}px`;
      letter.style.transform = `translate(-50%, -50%) translate(${dx}px, ${dy}px)`;

      letter.addEventListener('transitionend', () => {
        letter.style.position = 'static';
        letter.style.transform = 'none';
        toCell.appendChild(letter);
      }, { once: true });
    }

    function removeLetter(index) {
      const cell = topRow.children[index];
      const letter = cell.querySelector('.letter');
      letter.style.opacity = 0;
      letter.style.transform = 'scale(3.5)';
    }

    function fadeInLetter(toIndex, char) {
      const toCell = bottomRow.children[toIndex];
      const span = document.createElement('span');
      span.className = 'letter';
      span.textContent = char;
      span.style.opacity = 0;
      span.style.transform = 'scale(3.5)';
      toCell.innerHTML = '';
      toCell.appendChild(span);
      // Trigger fade in
      setTimeout(() => {
        span.style.opacity = 1;
        span.style.transform = 'scale(1.0)';
      }, 20);      
      // requestAnimationFrame(() => {
      //   span.style.opacity = 1;
      // });
    }

    function renderLinks() {
      const targetDiv = document.getElementById('links');
      targetDiv.innerHTML = '';
      solutions.forEach((_, index) => {
        const link = document.createElement('a');
        link.href = 'javascript:resetSelect(' + index + ')';
        link.textContent = solutions[index][1];
        link.title = solutions[index][1];
        link.style.marginRight = '8px';
        targetDiv.appendChild(link);      
      });
    }

    function resetSelect(w) {
      which = w;
      topString = solutions[which][0];  
      m = solutions[which][1].replace(/\s+/g, '').length;
      moves = solutions[which][2];
      fadeIns = solutions[which][3];

      topRow.innerHTML = "";      
      bottomRow.innerHTML = "";
      renderTopRow();
      renderBottomRow();
    }

  </script>
</body>
</html>
